$define(["wgt_util","wgt_readyload","tmpl"],function(g,e,k){return g.fn.etreeApart=function(e){var t=this,h=g(this),c=(e.handler,e.conf),s=c.item,f=[],u=c.elements,m=(c.treeData,c.commonConfig),d=(m.isNeedBox,[]),b=g(t).getScope(),C=function(e,s,d){var t=m.noData||"p_PromptNoneData";if(s&&s.length||1!=d){if(b.find("."+t).addClass("hide"),d==m.deep)for(var n=0;n<s.length;n++)s[n].isParent=!1;var i=g("#"+c.treeNode[p(d)],b).tmpl(s,{getTags:function(e){return this.data.tags.join(e)}});i.appendTo(e),e.removeClass("hide"),i.each(function(e,t){if(g(t).hasClass(u.box[f[p(e+1)]].zstyle)){if(g(t).data("item",s[e]),g(t).attr("level",d),s[e].children&&s[e].children.length&&(!m.deep||d<m.deep)&&C(g(t).find("."+y("childrenP",d)),s[e].children,d+1),s[e].children&&s[e].children.length&&1==s[e].open||"true"==s[e].open)g(t).find("."+y("childrenP",d)).removeClass("hide");else if(m.lightSelected){g(t).find("."+u.box[f[p(d)]].out.zstyle+".clicked")[0]||g(t).find("."+y("childrenP",d)).addClass("hide");var i={};location.search.replace(/[\?|&]([^&=]+)=([^&]+)/g,function(e,t,n){i[t]=n});var n=i.cateId?i.cateId:g.getUrlId();g(t).data("item").id+""==n&&(g(t).find("."+u.box[f[p(d)]].out.zstyle).addClass("clicked"),g(t).find("."+y("childrenP",d)).removeClass("hide"))}else g(t).find("."+y("childrenP",d)).addClass("hide");s[e].open?(g(t).find("."+y("button",d).btnOpen).removeClass("hide"),g(t).find("."+y("button",d).btnClose).addClass("hide"),g(t).addClass("click")):(g(t).find("."+y("button",d).btnOpen).addClass("hide"),g(t).find("."+y("button",d).btnClose).removeClass("hide")),y("button",d).show||(g(t).find("."+y("button",d).btnOpen).addClass("hide"),g(t).find("."+y("button",d).btnClose).addClass("hide"),g(t).find("."+u.dot.zstyle).addClass("hide")),g(t).css({"padding-left":22*(d-1)}),y("thumb",d)&&g(t).find("img").eq(0).onErrorImg(y("thumb",d).errorImg)}});var a=y("thumb",d);if(a){var l=i.find("."+a.zstyle);l.width(a.width),l.height(a.height),l.putPhotoDiv(),1==a.show||"true"==a.show?i.find("."+u[a.key].zstyle).removeClass("item_hide"):i.find("."+u[a.key].zstyle).addClass("item_hide")}var o=y("linkText",d);if(o.isShowLineNum){var r=i.find("."+y("linkText",d).linkText+" .font");r.width(r.width()),r.fixLineN(y("linkText",d).showlineNum)}1==o.show||"true"==o.show?i.find("."+u[o.key].link.zstyle).removeClass("item_hide"):i.find("."+u[o.key].link.zstyle).addClass("item_hide"),k.lazyImg({defObj:"#"+b.attr("id")})}else b.find("."+t).removeClass("hide"),h.addClass("hide")},o=function(e,t){g("."+y("childrenP",t),e).addClass("hide"),g(e).removeClass("click"),g(e).find("."+y("button",t).btnClose).eq(0).removeClass("hide"),g(e).find("."+y("button",t).btnOpen).eq(0).addClass("hide")},r=function(e,t){var l=g("."+y("nodeP",t),e);l.on("click",function(e){var n=parseInt(g(this).attr("level"));if(g(e.target).closest("."+y("button",n).btnClose).length||g(e.target).closest("."+y("button",n).btnOpen).length){if(g(this).hasClass("click"))o(this,n);else{var t=g(this).data("item");c.commonConfig.isExclusive&&l.each(function(e,t){o(t,n)});var i=g("."+y("childrenP",n),this).eq(0);if(i.html().trim()&&i.removeClass("hide"),!(i.html().trim()||m.deep&&n>=m.deep)&&t.isParent){i.removeClass("hide");var s=v(t);C(i,s,n+1),r(this,n+1)}g(this).addClass("click"),g(this).find("."+y("button",n).btnOpen).eq(0).removeClass("hide"),g(this).find("."+y("button",n).btnClose).eq(0).addClass("hide"),g(this).parents("."+y("childrenP",n)).removeClass("hide");var d=g(this).attr("level");for(g(this).find("."+y("childrenP",d)).find("."+y("button",n).btnOpen).addClass("hide"),g(this).find("."+y("childrenP",d)).find("."+y("button",n).btnClose).removeClass("hide"),g(this).find("."+y("nodeP",d)).removeClass("click");0<d;)g(this).parents("."+y("nodeP",d-1)+"[level="+(d-1)+"]").addClass("click"),g(this).parents("."+y("nodeP",d-1)+"[level="+(d-1)+"]").find("."+y("button",d-1).btnOpen).eq(0).removeClass("hide"),g(this).parents("."+y("nodeP",d-1)+"[level="+(d-1)+"]").find("."+y("button",d-1).btnClose).eq(0).addClass("hide"),d-=1}k.setCompPostion()}if(g(e.target).closest("."+y("linkText",n).inline).length){var a=y("linkText",n).action.click;a&&a(h,g(this),null,g(this).data("item"))}return!1})},v=function(e){var t,n={};if(!c.async&&c.treeData)return c.treeData;var i={},s=c.async.autoParam;if(e){for(var d=0;d<c.async.autoParam.length;d++)i[s[d]]=e[s[d]];i.id||(i.id=e.id)}return g.extend(n,c.async.otherParam,i),g.ajax({url:c.async.url,async:this.async||!1,type:c.async.type,dataType:"json",data:n,success:function(e){t=c.async.dataFilter?c.async.dataFilter(e):e}}),t},n=function(){for(var e=1;e<Object.getOwnPropertyNames(s).length+1;e++){var t={nodeP:u.box[f[p(e)]].zstyle,childrenP:u.childBox&&u.childBox.zstyle||"p_articlesF"},n=s[f[p(e)]];for(var i in n)"linkText"==n[i].type&&(t.linkText=n[i],t.linkText.isShowLineNum=n[i].config.isShowLineNum,t.linkText.showlineNum=n[i].config.showlineNum,t.linkText.linkText=u[n[i].key].text.zstyle,t.linkText.inline=u.box[f[p(e)]].inline.zstyle),"thumb"==n[i].type&&(t.thumb=n[i],t.thumb.zstyle=u[n[i].key].zstyle),"button"==n[i].type&&(t.button=n[i],t.button.btnOpen=u[n[i].key].zstyle,t.button.btnClose=u[n[i].depandStyleKey].zstyle);d.push(t)}},y=function(e,t){return d[p(t)][e]};this.triggerNode=function(e){this.async=!0;for(var t=e.length-1;0<=t;t--)0==t?this.find("#"+e[t]).addClass("active"):this.find("#"+e[t]).children(1).trigger("click");this.async=!1};var p=function(e){if(0==e||1==e)return 0;if(m&&!m.isDefindSubNode||"false"==m.isDefindSubNode)return 0;for(;null==f[e];)e-=1;return e};return function(){for(var e in s)f.push(e)}(),n(),C(t,v(),1),r(t,1),g.treeButtonClick=function(){},this},g});